<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SM Architect v6.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leader-line/1.0.7/leader-line.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #0f0f0f; color: #e5e5e5; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; user-select: none; -webkit-user-select: none; }
        #wikiModal, #adminModal { user-select: text; -webkit-user-select: text; }
        
        #viewport { flex: 1; position: relative; background-color: #121212; cursor: grab; width: 100%; height: 100%; overflow: hidden; }
        #viewport:active { cursor: grabbing; }
        
        /* –í–ê–ñ–ù–û: Origin 0 0 (–õ–µ–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª) */
        #canvas-container { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            transition: transform 0.1s cubic-bezier(0.1, 0.7, 0.1, 1); 
            transform-origin: 0 0; 
        }
        .bg-grid { position: absolute; inset: -5000px; z-index: 0; background-image: radial-gradient(#333 1px, transparent 1px); background-size: 20px 20px; opacity: 0.4; pointer-events: none; }

        .sm-block {
            position: absolute;
            width: 100px; height: 100px; 
            background: radial-gradient(circle at top left, #2a2a2a, #161616);
            border: 2px solid #444; border-radius: 8px;
            display: flex; flex-direction: column; justify-content: space-between;
            z-index: 10; box-shadow: 0 6px 12px rgba(0,0,0,0.6);
            pointer-events: auto; transition: border-color 0.2s;
        }
        .icon-container { flex-grow: 1; display: flex; align-items: center; justify-content: center; padding: 4px; width: 100%; overflow: hidden; }
        .img-layer { max-width: 100%; max-height: 100%; object-fit: contain; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5)); pointer-events: none; }
        .emoji-layer { font-size: 36px; pointer-events: none; }
        .sm-block-title { 
            width: 100%; background: rgba(0,0,0,0.8); border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 10px; font-weight: bold; text-transform: uppercase; color: #ccc; text-align: center; 
            padding: 4px 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-shrink: 0; pointer-events: none;
        }
        .block-idx { 
            position: absolute; top: -8px; left: -8px; background: #333; color: #fff; 
            width: 22px; height: 22px; border-radius: 50%; border: 1px solid #666; 
            font-family: monospace; font-size: 11px; font-weight: bold; 
            display: flex; align-items: center; justify-content: center; z-index: 20; box-shadow: 0 2px 4px rgba(0,0,0,0.5); pointer-events: none;
        }

        .type-input { border-color: #22c55e; } .type-logic { border-color: #a855f7; } .type-math { border-color: #f97316; } .type-output { border-color: #ef4444; } .type-util { border-color: #3b82f6; } .type-hidden { opacity: 0.5; border-style: dashed; border-color: #444; }
        .sm-block.active-highlight { border-color: #fb923c !important; box-shadow: 0 0 0 6px rgba(251, 146, 60, 0.4), 0 20px 40px rgba(0,0,0,0.9) !important; transform: scale(1.2); z-index: 100 !important; background: #222 !important; }

        .nav-item { width: 100%; height: 56px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #888; cursor: pointer; transition: all 0.2s; border-left: 3px solid transparent; flex-shrink: 0; }
        .nav-item:hover { background: #222; color: #fff; }
        .nav-item.active { color: #fb923c; border-left-color: #fb923c; background: #1a1a1a; }
        .nav-label { font-size: 0.6rem; font-weight: bold; text-transform: uppercase; margin-top: 2px; }
        
        ::-webkit-scrollbar { width: 4px; height: 4px; } 
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 2px; }
        ::-webkit-scrollbar-track { background: #0a0a0a; }
        
        @keyframes slideIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }
        .drawer-enter { animation: slideIn 0.2s ease-out forwards; }
    </style>
</head>
<body class="flex h-dvh text-base bg-[#0f0f0f] overflow-hidden select-none">

    <nav class="w-16 lg:w-20 bg-[#0a0a0a] border-r border-[#222] flex flex-col items-center py-2 z-40 shadow-xl shrink-0 h-full">
        <button onclick="clearScreen()" class="nav-item mb-1 text-orange-500 hover:text-orange-400" title="–î–æ–º–æ–π"><span class="text-2xl">üè†</span></button>
        <div class="flex-1 min-h-0 w-full overflow-y-auto flex flex-col items-center gap-1 py-2 no-scrollbar">
            <button onclick="filterCategory('input')" class="nav-item" id="nav-input"><img src="assets/icon_input.png" class="w-8 h-8 object-contain opacity-70 hover:opacity-100 transition-opacity" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'"><span class="text-2xl hidden">üéÆ</span><span class="nav-label">–í–≤–æ–¥</span></button>
            <button onclick="filterCategory('logic')" class="nav-item" id="nav-logic"><img src="assets/icon_logic.png" class="w-8 h-8 object-contain opacity-70 hover:opacity-100 transition-opacity" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'"><span class="text-2xl hidden">üß†</span><span class="nav-label">–õ–æ–≥–∏–∫–∞</span></button>
            <button onclick="filterCategory('output')" class="nav-item" id="nav-output"><img src="assets/icon_output.png" class="w-8 h-8 object-contain opacity-70 hover:opacity-100 transition-opacity" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'"><span class="text-2xl hidden">‚öôÔ∏è</span><span class="nav-label">–ú–µ—Ö.</span></button>
            <button onclick="filterCategory('util')" class="nav-item" id="nav-util"><img src="assets/icon_util.png" class="w-8 h-8 object-contain opacity-70 hover:opacity-100 transition-opacity" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'"><span class="text-2xl hidden">üß∞</span><span class="nav-label">–£—Ç–∏–ª.</span></button>
        </div>
        <div class="w-full border-t border-[#222] pt-2 mt-auto bg-[#0a0a0a] shrink-0 pb-safe">
            <button onclick="autoFitView()" class="nav-item" title="–ê–≤—Ç–æ-–º–∞—Å—à—Ç–∞–±"><span class="text-xl">üéØ</span></button>
            <button onclick="openWiki()" class="nav-item" title="–í–∏–∫–∏"><span class="text-xl">üìñ</span></button>
            <button onclick="openAdmin()" class="nav-item" title="–ê–¥–º–∏–Ω–∫–∞"><span class="text-xl">‚öôÔ∏è</span></button>
        </div>
    </nav>

    <aside id="blockDrawer" class="absolute left-16 lg:left-20 top-0 bottom-0 w-64 bg-[#141414] border-r border-[#222] flex flex-col z-30 drawer-enter hidden shadow-2xl h-full">
        <div class="p-4 border-b border-[#222] flex justify-between items-center bg-[#1a1a1a] shrink-0"><h2 id="drawerTitle" class="font-bold text-gray-200 text-sm uppercase tracking-wider">–ë–ª–æ–∫–∏</h2><button onclick="closeDrawer()" class="text-gray-500 hover:text-white p-2 text-lg">‚úï</button></div>
        <div class="p-3 border-b border-[#222] shrink-0"><input type="text" id="searchBox" placeholder="–ü–æ–∏—Å–∫..." class="w-full bg-[#0a0a0a] border border-[#333] rounded px-3 py-2 text-sm text-white focus:border-orange-500 outline-none" onkeyup="searchBlocks()"></div>
        <div id="menuList" class="flex-1 overflow-y-auto p-2 space-y-1 pb-10 min-h-0"></div>
    </aside>

    <main class="flex-1 flex flex-col relative bg-[#121212] h-full overflow-hidden">
        <div id="topPanel" class="absolute top-0 left-0 right-0 bg-[#1a1a1a]/95 backdrop-blur border-b border-[#333] p-4 lg:p-6 z-20 hidden shadow-lg"><div class="flex justify-between items-start max-w-4xl mx-auto"><div><h2 class="text-xl font-bold text-orange-400 mb-2" id="infoTitle"></h2><div class="text-gray-300 text-sm leading-relaxed" id="infoDesc"></div></div><button onclick="document.getElementById('topPanel').classList.add('hidden')" class="text-gray-500 hover:text-white ml-6 text-xl font-bold p-2">‚úï</button></div></div>
        
        <div id="viewport" onclick="closeDrawerMobile()">
            <div id="canvas-container">
                <div class="bg-grid"></div>
                <div id="canvas-content">
                    <div id="placeholder" class="text-gray-600 text-center pointer-events-none select-none absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                        <div class="text-6xl mb-4 opacity-20">üõ†</div><div class="text-lg">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</div>
                    </div>
                </div>
            </div>
        </div>

        <button id="inspectorBtnMobile" onclick="toggleInspector()" class="fixed bottom-8 right-8 w-16 h-16 bg-orange-600 text-white rounded-full shadow-[0_4px_20px_rgba(249,115,22,0.6)] flex items-center justify-center text-3xl font-bold z-30 hover:bg-orange-500 active:scale-90 transition-transform lg:hidden">i</button>
        <button id="inspectorBtnPC" onclick="toggleInspector()" class="absolute top-4 right-4 w-10 h-10 bg-[#222] border border-[#444] text-gray-400 rounded hover:text-white hover:border-orange-500 hidden lg:flex items-center justify-center z-40 transition-all" title="–ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å">‚ñ∂</button>

        <div id="connectionsPanel" class="fixed bottom-0 right-0 w-full lg:w-96 bg-[#1a1a1a] border-t lg:border-l border-[#333] z-50 transition-transform duration-300 flex flex-col max-h-[60vh] lg:max-h-full h-auto lg:h-full shadow-[0_-10px_40px_rgba(0,0,0,0.8)] rounded-t-3xl lg:rounded-none lg:static lg:fixed lg:right-0 lg:top-0 translate-y-full lg:translate-x-full">
            <div class="p-4 border-b border-[#333] bg-[#222] flex justify-between items-center rounded-t-3xl lg:rounded-none cursor-pointer" onclick="toggleInspector()"><h3 class="font-bold text-orange-500 text-sm uppercase tracking-widest pl-2">üì° Connections</h3><button class="lg:hidden text-gray-400 px-4 text-xl">‚ñº</button></div>
            <div id="connectionsList" class="p-5 overflow-y-auto flex-1 space-y-3 text-sm font-mono text-gray-400 min-h-0"><div class="text-center opacity-50 mt-4">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ö–µ–º—ã</div></div>
        </div>
    </main>

    <div id="wikiModal" class="fixed inset-0 bg-black/90 hidden z-[100] flex items-center justify-center p-4 backdrop-blur-sm" onclick="if(event.target===this)closeWiki()"><div class="bg-[#1a1a1a] w-full max-w-4xl h-[85vh] rounded-2xl border border-[#333] flex flex-col shadow-2xl"><div class="p-4 border-b border-[#333] flex justify-between items-center"><h2 class="text-2xl font-bold text-orange-500">üìö Wiki</h2><button onclick="closeWiki()" class="text-3xl text-gray-500 hover:text-white p-2">&times;</button></div><div class="p-8 overflow-y-auto space-y-8 text-gray-300" id="wikiContent"></div></div></div>
    <div id="adminModal" class="fixed inset-0 bg-black/95 hidden z-[110] flex items-center justify-center p-4 backdrop-blur-md" onclick="if(event.target===this)closeAdmin()"><div class="bg-[#1a1a1a] w-full max-w-3xl rounded-xl border border-[#333] flex flex-col shadow-2xl max-h-[90vh]"><div class="p-5 border-b border-[#333] flex justify-between items-center"><h2 class="text-xl font-bold text-blue-400">‚öôÔ∏è Admin</h2><button onclick="closeAdmin()" class="text-gray-500 hover:text-white p-2">‚úï</button></div><div class="p-6 overflow-y-auto flex-1 space-y-4"><textarea id="universalImport" class="w-full h-60 bg-[#0a0a0a] border border-[#333] rounded p-4 text-sm font-mono text-green-400 focus:border-blue-500 outline-none" placeholder="JSON..."></textarea><div class="flex gap-3 pt-2"><button onclick="copyKeys()" class="px-4 py-3 bg-[#222] text-gray-300 rounded border border-[#333] hover:text-white text-sm font-bold flex-1">üìã Keys</button><button onclick="universalMerge()" class="px-4 py-3 bg-blue-900/30 text-blue-300 rounded border border-blue-800 hover:bg-blue-800 hover:text-white text-sm font-bold flex-1">Import</button></div></div></div></div>

    <script src="blocks.js?v=6.2"></script>
    <script src="wiki.js?v=6.2"></script>
    <script src="presets.js?v=6.2"></script>
    <script src="wires.js?v=6.2"></script>
    <script src="engine.js?v=6.2"></script>
</body>
</html>